<h1 class="text-center mb-4 carrito">Mi Carrito</h1>

<div class="cart-container d-flex flex-wrap justify-content-center gap-3">
  {{#if cart.products.length}}
    {{#each cart.products}}
      <div class="cart-item card text-center p-2">
        <img src="{{this.product.thumbnail}}" alt="{{this.product.title}}" class="mb-2" style="width:150px; height:150px; object-fit:cover; border-radius:8px;">
        <h3>{{this.product.title}}</h3>
        <p>Precio: ${{this.product.price}}</p>
        <p>Cantidad: {{this.quantity}}</p>
        <button class="removeFromCartBtn" data-id="{{this.product._id}}">Eliminar</button>
      </div>
    {{/each}}

    <!-- Botón global para vaciar el carrito -->
    <div class="w-100 text-center mt-4">
      <button id="clearCartBtn" class="btn btn-danger">Vaciar carrito</button>
    </div>
  {{else}}
    <p>El carrito está vacío</p>
  {{/if}}
</div>

<script>
let cartId = localStorage.getItem('cartId');

document.querySelectorAll('.removeFromCartBtn').forEach(btn => {
  btn.onclick = async () => {
    const productId = btn.getAttribute('data-id');
    const res = await fetch(`/api/carts/${cartId}/products/${productId}`, { method: 'DELETE' });
    if(res.ok) {
      alert('Producto eliminado del carrito');
      location.reload();
    } else {
      alert('Error al eliminar producto');
    }
  };
});

document.getElementById('clearCartBtn')?.addEventListener('click', async () => {
  const res = await fetch(`/api/carts/${cartId}`, { method: 'DELETE' });
  if(res.ok) {
    alert('Carrito vaciado');
    location.reload();
  } else {
    alert('Error al vaciar carrito');
  }
});
</script>
